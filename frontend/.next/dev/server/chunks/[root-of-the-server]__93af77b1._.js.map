{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/New/Videos/Project/ictvisitorsfrontendsystem%20Frontend/app/api/chat/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\r\nimport { GoogleGenerativeAI } from \"@google/generative-ai\"\r\n\r\nconst SYSTEM_PROMPT = `\r\nYou are the \"Sweet and Professional\" Concierge for the ICT Visitors System. Your name is \"VisitorBot\".\r\nYour goal is to help students, staff, and visitors navigating the system.\r\nYour tone should be:\r\n- Sweet: Friendly, polite, using emojis occasionally (âœ¨, ðŸ˜Š).\r\n- Professional: Concise, helpful, accurate.\r\n\r\nCONTEXT about the ICT Visitors System:\r\n1. **Purpose**: A modern, full-stack visitor management platform for the ICT Faculty.\r\n2. **Student Portal Features**:\r\n   - **Smart Check-in**: Students enter details (Name, Program, Purpose) and MUST take a **real-time selfie** for security.\r\n   - **Digital Visitor Pass**: Generates a downloadable PDF ID card with a dynamic QR code and the user's photo.\r\n   - **Check-out Feedback**: Users rate their experience (1-5 stars) upon checking out.\r\n   - **History**: View recent 5 visits.\r\n3. **Admin & Staff Features**:\r\n   - **Live Analytics**: Weekly, Monthly, and Peak Hour visitor charts.\r\n   - **User Management**: Admins can add, remove, or promote users (Student, Staff, Security, Admin).\r\n   - **Communication**: Two-way messaging inbox to chat with students/visitors directly.\r\n   - **Dynamic Settings**: Manage available Departments and Programs.\r\n4. **General Info**:\r\n   - **Authentication**: Login via Username/Password OR Social Login (Google, Facebook, TikTok).\r\n   - **Location**: ICT Faculty Building.\r\n   - **Hours**: 8:00 AM - 5:00 PM (Mon-Fri).\r\n\r\nRULES:\r\n- If asked about login, mention BOTH local (username/password) and social options.\r\n- If asked about \"how to check in\", emphasize the **selfie requirement**.\r\n- If asked about technical bugs, suggest contacting \"Admin Support\" via the dashboard inbox.\r\n- Keep responses friendly, professional, and concise (under 3 sentences).\r\n`\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const body = await req.json()\r\n        const { messages } = body\r\n\r\n        // Get the last user message\r\n        const lastMessage = messages[messages.length - 1].content\r\n\r\n        if (!process.env.GEMINI_API_KEY) {\r\n            return NextResponse.json(\r\n                {\r\n                    role: \"assistant\",\r\n                    content: \"I'm currently running in 'Offline Mode' because my AI brain (Gemini API Key) isn't connected yet! âœ¨ Please add a GEMINI_API_KEY to the system settings.\"\r\n                },\r\n                { status: 200 }\r\n            )\r\n        }\r\n\r\n        const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY)\r\n        // Use gemini-2.5-flash which is available in the free tier\r\n        const model = genAI.getGenerativeModel({\r\n            model: \"gemini-2.5-flash\",\r\n        })\r\n\r\n        // Provide context via system instruction equivalent (or prepended context)\r\n        const prompt = `${SYSTEM_PROMPT}\\n\\nUser Question: ${lastMessage}`\r\n\r\n        const result = await model.generateContent(prompt)\r\n        const response = result.response\r\n        const text = response.text()\r\n\r\n        return NextResponse.json({ role: \"assistant\", content: text })\r\n    } catch (error: any) {\r\n        console.error(\"Gemini Error:\", error)\r\n        return NextResponse.json(\r\n            {\r\n                role: \"assistant\",\r\n                content: `I encountered an error: ${error?.message || 'Unknown error'}. Please check your API key or try again later. ðŸ˜“`\r\n            },\r\n            { status: 200 }\r\n        )\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,gBAAgB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6BvB,CAAC;AAEM,eAAe,KAAK,GAAY;IACnC,IAAI;QACA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,QAAQ,EAAE,GAAG;QAErB,4BAA4B;QAC5B,MAAM,cAAc,QAAQ,CAAC,SAAS,MAAM,GAAG,EAAE,CAAC,OAAO;QAEzD,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;YAC7B,OAAO,uLAAY,CAAC,IAAI,CACpB;gBACI,MAAM;gBACN,SAAS;YACb,GACA;gBAAE,QAAQ;YAAI;QAEtB;QAEA,MAAM,QAAQ,IAAI,6NAAkB,CAAC,QAAQ,GAAG,CAAC,cAAc;QAC/D,2DAA2D;QAC3D,MAAM,QAAQ,MAAM,kBAAkB,CAAC;YACnC,OAAO;QACX;QAEA,2EAA2E;QAC3E,MAAM,SAAS,GAAG,cAAc,mBAAmB,EAAE,aAAa;QAElE,MAAM,SAAS,MAAM,MAAM,eAAe,CAAC;QAC3C,MAAM,WAAW,OAAO,QAAQ;QAChC,MAAM,OAAO,SAAS,IAAI;QAE1B,OAAO,uLAAY,CAAC,IAAI,CAAC;YAAE,MAAM;YAAa,SAAS;QAAK;IAChE,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,uLAAY,CAAC,IAAI,CACpB;YACI,MAAM;YACN,SAAS,CAAC,wBAAwB,EAAE,OAAO,WAAW,gBAAgB,kDAAkD,CAAC;QAC7H,GACA;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}